// Abstraction for a list of references
mixin references(references)
  each reference, i in references
    if i != 0
      | , 
    a(href="http://www.ncbi.nlm.nih.gov/pubmed/" + reference.id)
      | #{reference.type}:#{reference.id}

html
  head
    title Mutation Report for #{data.mutation} (#{data.shortMutation}) in #{data.gene}
  body
    h2 Frequency of G12A mutation in KRAS in the top tumour types

    table
      thead
        tr
          th Tumour
          th Frequency
          th Samples
      tbody

    hr

    h2 #{data.gene} #{data.mutation} Characteristics

    - var action = data.sections.clinical.data.action

    p 
      | The functional consequence of this mutation is:
      b #{action.type}
      | Reference (PMID): 
      +references(action.reference)

    hr

    h2 Clinical and Preclinical Studies

    - var significances = data.sections.clinical.data.significance
    - var sigTypes = {}
    - significances.forEach(function(s) { sigTypes[s["tumourType"]] = []; });
    - significances.forEach(function(s) { sigTypes[s["tumourType"]].push(s); });
    each sigType, i in Object.keys(sigTypes).sort()
      h3 #{sigType}
      each significance, j in sigTypes[sigType]
        p
          i
            | In this tumour type, the clinical significance of this mutation has been examined by
            | #{significance.studyType}
            | clinical trials
        p
          | Comment: 
          | #{significance.comment}
        p
          | Reference (PMID): 
          +references(significance.reference)
          | Evidence: 
          | #{significance.levelOfEvidence}

    hr

    h2 Availability of Investigational Agents

    - var agents = data.sections.clinical.data.agents
    if agents.length > 0
      each agent, i in agents
        p
          b #{agent.sensitivity}: 
          | #{agent.name}

    hr

    h2 Sensitivity and Resistance Conferred by Mutation

